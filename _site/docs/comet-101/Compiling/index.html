<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../icon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../icon/favicon-16x16.png"><link rel="manifest" href="../icon/site.webmanifest"><link rel="mask-icon" href="../icon/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/dev.io/assets/css/just-the-docs-default.css"><link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-blue.min.css" /> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2709176-10"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2709176-10', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="/dev.io/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/dev.io/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Compiling &amp; Linking | SDSC-101-Dev</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Compiling &amp; Linking" /><meta property="og:locale" content="en_US" /><meta name="description" content="SDSC-101 Dev branch" /><meta property="og:description" content="SDSC-101 Dev branch" /><link rel="canonical" href="http://localhost:4000/dev.io/docs/comet-101/Compiling/" /><meta property="og:url" content="http://localhost:4000/dev.io/docs/comet-101/Compiling/" /><meta property="og:site_name" content="SDSC-101-Dev" /> <script type="application/ld+json"> {"description":"SDSC-101 Dev branch","url":"http://localhost:4000/dev.io/docs/comet-101/Compiling/","@type":"WebPage","headline":"Compiling &amp; Linking","@context":"https://schema.org"}</script> <button class="btn js-toggle-dark-mode">dark scheme</button> <script> const toggleDarkMode = document.querySelector('.js-toggle-dark-mode'); jtd.addEvent(toggleDarkMode, 'click', function(){ if (jtd.getTheme() === 'dark') { jtd.setTheme('light'); toggleDarkMode.textContent = 'dark scheme'; } else { jtd.setTheme('dark'); toggleDarkMode.textContent = 'light scheme'; } }); </script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000/dev.io/" class="site-title lh-tight"> SDSC-101-Dev </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/comet" class="nav-list-link">Comet 101</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Comet%20Overview/" class="nav-list-link">Comet Overview</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Getting%20Started%20on%20Comet/" class="nav-list-link">Getting Started on Comet</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Customizing/" class="nav-list-link">Customizing Your User Environment</a><li class="nav-list-item active"><a href="http://localhost:4000/dev.io/docs/comet-101/Compiling/" class="nav-list-link active">Compiling & Linking</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Running%20Jobs/" class="nav-list-link">Running Jobs on Comet</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/comet/examples" class="nav-list-link">Hands-on Examples</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/comet-101/gpu/" class="nav-list-link">comp-and-run-cuda-jobs</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/comet-101/cpu/" class="nav-list-link">Compiling and Running CPU Jobss</a></ul></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/expanse" class="nav-list-link">Expanse 101</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/Expanse%20Overview/" class="nav-list-link">Expanse Overview</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/start/" class="nav-list-link">Getting Started on Expanse</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/Customizing/" class="nav-list-link">Customizing Your User Environment</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/Compiling/" class="nav-list-link">Compiling & Linking</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/slurm/" class="nav-list-link">Using Slurm on Comet</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/expanse/examples" class="nav-list-link">Hands-on Examples</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/expanse-101/gpu/" class="nav-list-link">comp-and-run-cuda-jobs</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/expanse-101/cpu/" class="nav-list-link">Compiling and Running CPU Jobs</a></ul></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/notebooks" class="nav-list-link">notebooks-101</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/contactus/" class="nav-list-link">Contact Us</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/overview/" class="nav-list-link">Jupyter Notebook Overview</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/prerequisites/" class="nav-list-link">Software Prerequisites</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/aboutus/" class="nav-list-link">About the Team</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/notebooks/examples" class="nav-list-link">Example Notebooks</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/notebooks-101/httpConnect/" class="nav-list-link">Insecurity with direct node access</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/notebooks-101/reverseProxy/" class="nav-list-link">Security with Reverse Proxy Service</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/notebooks-101/runJupyterMethods/" class="nav-list-link">Jupyter Services on Comet</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/notebooks-101/tunneling/" class="nav-list-link">Security with SSH Tunneling</a></ul></ul></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search SDSC-101-Dev" aria-label="Search SDSC-101-Dev" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="" class="site-button" > SDSC 101 on GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/dev.io/docs/comet">Comet 101</a><li class="breadcrumb-nav-list-item"><span>Compiling & Linking</span></ol></nav><div id="main-content" class="main-content" role="main"><h2 id="compiling--linking"> <a href="#compiling--linking" class="anchor-heading" aria-labelledby="compiling--linking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a name="compilers"></a>Compiling &amp; Linking</h2><p>Comet provides the Intel, Portland Group (PGI), and GNU compilers along with multiple MPI implementations (MVAPICH2, MPICH2, OpenMPI). Most applications will achieve the best performance on Comet using the Intel compilers and MVAPICH2 and the majority of libraries installed on Comet have been built using this combination.</p><p>Other compilers and versions can be installed by Comet staff on request. For more information, see the user guide: http://www.sdsc.edu/support/user_guides/comet.html#compiling</p><h3 id="supported-compiler-types"> <a href="#supported-compiler-types" class="anchor-heading" aria-labelledby="supported-compiler-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a name="compilers-supported"></a>Supported Compiler Types</h3><p>Comet compute nodes support several parallel programming models:</p><ul><li><strong>MPI</strong>: Default: Intel<li>Default Intel Compiler: intel/2018.1.163; Other versions available.<li>Other options: openmpi_ib/1.8.4 (and 1.10.2), Intel MPI, mvapich2_ib/2.1<li>mvapich2_gdr: GPU direct enabled version<li><strong>OpenMP</strong>: All compilers (GNU, Intel, PGI) have OpenMP flags.<li><strong>GPU nodes</strong>: support CUDA, OpenACC.<li><strong>Hybrid modes</strong> are possible.</ul><p>In this tutorial, we include several hands-on examples that cover many of the cases in the table:</p><ul><li>MPI<li>OpenMP<li>HYBRID<li>GPU<li>Local scratch</ul><p>Default/Suggested Compilers to used based on programming model and languages:</p><div class="table-wrapper"><table><thead><tr><th> <th>Serial<th>MPI<th>OpenMP<th>MPI+OpenMP<tbody><tr><td>Fortran<td>ifort<td>mpif90<td>ifort -openmp<td>mpif90 -openmp<tr><td>C<td>icc<td>mpicc<td>icc -openmp<td>mpicc -openmp<tr><td>C++<td>icpc<td>mpicxx<td>icpc -openmp<td>mpicxx -openmp</table></div><p><a href="#top">Back to Top</a></p><hr /><h3 id="using-the-intel-compilers"> <a href="#using-the-intel-compilers" class="anchor-heading" aria-labelledby="using-the-intel-compilers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a name="compilers-intel"></a>Using the Intel Compilers:</h3><p>The Intel compilers and the MVAPICH2 MPI implementation will be loaded by default. If you have modified your environment, you can reload by executing the following commands at the Linux prompt or placing in your startup file (~/.cshrc or ~/.bashrc) or into a module load script (see above).</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module purge
module load intel mvapich2_ib
</code></pre></div></div><p>For AVX2 support, compile with the -xHOST option. Note that -xHOST alone does not enable aggressive optimization, so compilation with -O3 is also suggested. The -fast flag invokes -xHOST, but should be avoided since it also turns on interprocedural optimization (-ipo), which may cause problems in some instances.</p><p>Intel MKL libraries are available as part of the “intel” modules on Comet. Once this module is loaded, the environment variable MKL_ROOT points to the location of the mkl libraries. The MKL link advisor can be used to ascertain the link line (change the MKL_ROOT aspect appropriately).</p><p>In the example below, we are working with the HPC examples that can be found in</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[user@comet-14-01:~/comet-examples/comet101/MKL] pwd
/home/user/comet-examples/comet101/MKL
[user@comet-14-01:~/comet-examples/comet101/MKL] ls -al
total 25991
drwxr-xr-x  2 user use300        9 Nov 25 17:20 .
drwxr-xr-x 16 user use300       16 Aug  5 19:02 ..
-rw-r--r--  1 user use300      325 Aug  5 19:02 compile.txt
-rw-r--r--  1 user use300     6380 Aug  5 19:02 pdpttr.c
-rwxr-xr-x  1 user use300 44825440 Nov 25 16:55 pdpttr.exe
-rw-r--r--  1 user use300      188 Nov 25 16:57 scalapack.20294236.comet-07-27.out
-rw-r--r--  1 user use300      376 Aug  5 19:02 scalapack.sb
</code></pre></div></div><p>The file <code class="language-plaintext highlighter-rouge">compile.txt</code> contains the full command to compile the <code class="language-plaintext highlighter-rouge">pdpttr.c</code> program statically linking 64 bit scalapack libraries on Comet:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[user@comet-14-01:~/comet-examples/comet101/MKL] cat compile.txt
mpicc -o pdpttr.exe pdpttr.c /opt/intel/2018.1.163/compilers_and_libraries_2018.1.163/linux/mkl/lib/intel64/libmkl_scalapack_lp64.a -Wl,--start-group /opt/intel/2018.1.163/compilers_and_libraries_2018.1.163/linux/mkl/lib/intel64/libmkl_intel_lp64.a /opt/intel/2018.1.163/compilers_and_libraries_2018.1.163/linux/mkl/lib/intel64/libmkl_sequential.a /opt/intel/2018.1.163/compilers_and_libraries_2018.1.163/linux/mkl/lib/intel64/libmkl_core.a /opt/intel/2018.1.163/compilers_and_libraries_2018.1.163/linux/mkl/lib/intel64/libmkl_blacs_intelmpi_lp64.a -Wl,--end-group -lpthread -lm -ldl
</code></pre></div></div><p>Run the command:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[user@comet-14-01:~/comet-examples/comet101/MKL] mpicc -o pdpttr.exe pdpttr.c  -I$MKL_ROOT/include ${MKL_ROOT}/lib/intel64/libmkl_scalapack_lp64.a -Wl,--start-group ${MKL_ROOT}/lib/intel64/libmkl_intel_lp64.a ${MKL_ROOT}/lib/intel64/libmkl_core.a ${MKL_ROOT}/lib/intel64/libmkl_sequential.a -Wl,--end-group ${MKL_ROOT}/lib/intel64/libmkl_blacs_intelmpi_lp64.a -lpthread -lm
</code></pre></div></div><p>For more information on the Intel compilers run: [ifort | icc | icpc] -help</p><p><a href="#top">Back to Top</a></p><hr /><h3 id="using-the-pgi-compilers"> <a href="#using-the-pgi-compilers" class="anchor-heading" aria-labelledby="using-the-pgi-compilers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a name="compilers-pgi"></a>Using the PGI Compilers</h3><p>The PGI compilers can be loaded by executing the following commands at the Linux prompt or placing in your startup file (~/.cshrc or ~/.bashrc)</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module purge
module load pgi mvapich2_ib
</code></pre></div></div><p>For AVX support, compile with -fast</p><div class="table-wrapper"><table><tbody><tr><td>For more information on the PGI compilers: man [pgf90<td>pgcc<td>pgCC]</table></div><div class="table-wrapper"><table><thead><tr><th> <th>Serial<th>MPI<th>OpenMP<th>MPI+OpenMP<tbody><tr><td>pgf90<td>mpif90<td>pgf90 -mp<td>mpif90 -mp<td> <tr><td>C<td>pgcc<td>mpicc<td>pgcc -mp<td>mpicc -mp<tr><td>C++<td>pgCC<td>mpicxx<td>pgCC -mp<td>mpicxx -mp</table></div><p><a href="#top">Back to Top</a></p><hr /><h3 id="using-the-gnu-compilers"> <a href="#using-the-gnu-compilers" class="anchor-heading" aria-labelledby="using-the-gnu-compilers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a name="compilers-gnu"></a>Using the GNU Compilers</h3><p>The GNU compilers can be loaded by executing the following commands at the Linux prompt or placing in your startup files (~/.cshrc or ~/.bashrc)</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module purge
module load gnu openmpi_ib
</code></pre></div></div><p>For AVX support, compile with -mavx. Note that AVX support is only available in version 4.7 or later, so it is necessary to explicitly load the gnu/4.9.2 module until such time that it becomes the default.</p><div class="table-wrapper"><table><tbody><tr><td>For more information on the GNU compilers: man [gfortran<td>gcc<td>g++]</table></div><div class="table-wrapper"><table><thead><tr><th> <th>Serial<th>MPI<th>OpenMP<th>MPI+OpenMP<tbody><tr><td>Fortran<td>gfortran<td>mpif90<td>gfortran -fopenmp<td>mpif90 -fopenmp<tr><td>C<td>gcc<td>mpicc<td>gcc -fopenmp<td>mpicc -fopenmp<tr><td>C++<td>g++<td>mpicxx<td>g++ -fopenmp<td>mpicxx -fopenmp</table></div><p><a href="#top">Back to Top</a></p><hr /><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-000 mb-0">Copyright &copy; Cyber Infrastructure Machine Learning MIT license.</a></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/Lzy17/expanse101-Jekyll/tree/main/docs/comet-101/Compiling.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
