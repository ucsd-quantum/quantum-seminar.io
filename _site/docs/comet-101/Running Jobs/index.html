<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../icon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../icon/favicon-16x16.png"><link rel="manifest" href="../icon/site.webmanifest"><link rel="mask-icon" href="../icon/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/dev.io/assets/css/just-the-docs-default.css"><link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-blue.min.css" /> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2709176-10"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2709176-10', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="/dev.io/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/dev.io/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Running Jobs on Comet | SDSC-101-Dev</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Running Jobs on Comet" /><meta property="og:locale" content="en_US" /><meta name="description" content="SDSC-101 Dev branch" /><meta property="og:description" content="SDSC-101 Dev branch" /><link rel="canonical" href="http://localhost:4000/dev.io/docs/comet-101/Running%20Jobs/" /><meta property="og:url" content="http://localhost:4000/dev.io/docs/comet-101/Running%20Jobs/" /><meta property="og:site_name" content="SDSC-101-Dev" /> <script type="application/ld+json"> {"description":"SDSC-101 Dev branch","url":"http://localhost:4000/dev.io/docs/comet-101/Running%20Jobs/","@type":"WebPage","headline":"Running Jobs on Comet","@context":"https://schema.org"}</script> <button class="btn js-toggle-dark-mode">dark scheme</button> <script> const toggleDarkMode = document.querySelector('.js-toggle-dark-mode'); jtd.addEvent(toggleDarkMode, 'click', function(){ if (jtd.getTheme() === 'dark') { jtd.setTheme('light'); toggleDarkMode.textContent = 'dark scheme'; } else { jtd.setTheme('dark'); toggleDarkMode.textContent = 'light scheme'; } }); </script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000/dev.io/" class="site-title lh-tight"> SDSC-101-Dev </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/comet" class="nav-list-link">Comet 101</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Comet%20Overview/" class="nav-list-link">Comet Overview</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Getting%20Started%20on%20Comet/" class="nav-list-link">Getting Started on Comet</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Customizing/" class="nav-list-link">Customizing Your User Environment</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Compiling/" class="nav-list-link">Compiling & Linking</a><li class="nav-list-item active"><a href="http://localhost:4000/dev.io/docs/comet-101/Running%20Jobs/" class="nav-list-link active">Running Jobs on Comet</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/comet/examples" class="nav-list-link">Hands-on Examples</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/comet-101/gpu/" class="nav-list-link">comp-and-run-cuda-jobs</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/comet-101/cpu/" class="nav-list-link">Compiling and Running CPU Jobss</a></ul></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/expanse" class="nav-list-link">Expanse 101</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/Expanse%20Overview/" class="nav-list-link">Expanse Overview</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/start/" class="nav-list-link">Getting Started on Expanse</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/Customizing/" class="nav-list-link">Customizing Your User Environment</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/Compiling/" class="nav-list-link">Compiling & Linking</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/slurm/" class="nav-list-link">Using Slurm on Comet</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/expanse/examples" class="nav-list-link">Hands-on Examples</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/expanse-101/gpu/" class="nav-list-link">comp-and-run-cuda-jobs</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/expanse-101/cpu/" class="nav-list-link">Compiling and Running CPU Jobs</a></ul></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/notebooks" class="nav-list-link">notebooks-101</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/contactus/" class="nav-list-link">Contact Us</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/overview/" class="nav-list-link">Jupyter Notebook Overview</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/prerequisites/" class="nav-list-link">Software Prerequisites</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/aboutus/" class="nav-list-link">About the Team</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/notebooks/examples" class="nav-list-link">Example Notebooks</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/notebooks-101/httpConnect/" class="nav-list-link">Insecurity with direct node access</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/notebooks-101/reverseProxy/" class="nav-list-link">Security with Reverse Proxy Service</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/notebooks-101/runJupyterMethods/" class="nav-list-link">Jupyter Services on Comet</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/notebooks-101/tunneling/" class="nav-list-link">Security with SSH Tunneling</a></ul></ul></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search SDSC-101-Dev" aria-label="Search SDSC-101-Dev" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="" class="site-button" > SDSC 101 on GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/dev.io/docs/comet">Comet 101</a><li class="breadcrumb-nav-list-item"><span>Running Jobs on Comet</span></ol></nav><div id="main-content" class="main-content" role="main"><h2 id="running-jobs-on-comet-"> <a href="#running-jobs-on-comet-" class="anchor-heading" aria-labelledby="running-jobs-on-comet-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running Jobs on Comet <a name="running-jobs"></a></h2><p>Comet manages computational work via the Simple Linux Utility for Resource Management (SLURM) batch environment. Comet places limits on the number of jobs queued and running on a per group (allocation) and partition basis. Submitting a large number of jobs (especially very short ones) can impact the overall scheduler response for all users. If you are anticipating submitting a lot of jobs, contact the SDSC consulting staff before you submit them. We can work to check if there are bundling options that make your workflow more efficient and reduce the impact on the scheduler</p><p>For more details, see the section on Running job in the Comet User Guide: http://www.sdsc.edu/support/user_guides/comet.html#running</p><h3 id="the-simple--linux-utility-for-resource-management--slurm-"> <a href="#the-simple--linux-utility-for-resource-management--slurm-" class="anchor-heading" aria-labelledby="the-simple--linux-utility-for-resource-management--slurm-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Simple Linux Utility for Resource Management (SLURM) <a name="running-jobs-slurm"></a></h3><p><img src="images/slurm.png" alt="Simple Linux Utility for Resource Management" width="500px" /></p><ul><li>“Glue” for parallel computer to schedule and execute jobs<li>Role: Allocate resources within a cluster<li>Nodes (unique IP address)<li>Interconnect/switches<li>Generic resources (e.g. GPUs)<li><p>Launch and otherwise manage jobs</p><li>Functionality:<li>Prioritize queue(s) of jobs;<li>decide when and where to start jobs;<li>terminate job when done;<li>Appropriate resources;<li><p>Manage accounts for jobs</p><li>All jobs must be run via the Slurm scheduling infrastructure. There are two types of jobs:<li><a href="#running-jobs-slurm-interactive">Interactive Jobs</a><li><a href="#running-jobs-slurm-batch-submit">Batch Jobs</a></ul><p><a href="#top">Back to Top</a></p><hr /><h3 id="interactive-jobs-"> <a href="#interactive-jobs-" class="anchor-heading" aria-labelledby="interactive-jobs-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interactive Jobs: <a name="running-jobs-slurm-interactive"></a></h3><p>Interactive HPC systems allow <em>real-time</em> user inputs in order to facilitate code development, real-time data exploration, and visualizations. An interactive job (also referred as interactive session) will provide you with a shell on a compute node in which you can launch your jobs. On Comet, use the <code class="language-plaintext highlighter-rouge">srun</code> command:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>srun --pty --nodes=1 --ntasks-per-node=24 -p debug -t 00:30:00 --wait 0 /bin/bash
</code></pre></div></div><p>For more information, see the interactive computing tutorial <a href="https://github.com/sdsc/sdsc-summer-institute-2020/blob/master/0_preparation/interactive_computing/README.md">here</a>.</p><h3 id="batch-jobs-using-slurm-"> <a href="#batch-jobs-using-slurm-" class="anchor-heading" aria-labelledby="batch-jobs-using-slurm-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Batch Jobs using SLURM: <a name="running-jobs-slurm-batch"></a></h3><p>When you run in the batch mode, you submit jobs to be run on the compute nodes using the <code class="language-plaintext highlighter-rouge">sbatch</code> command (described below).</p><p>Batch scripts are submitted from the login nodes. You can set environment variables in the shell or in the batch script, including:</p><ul><li>Partition (also called the qeueing system)<li>Time limit for a job (maximum of 48 hours; longer on request)<li>Number of nodes, tasks per node<li>Memory requirements (if any)<li>Job name, output file location<li>Email info, configuration</ul><p>Below is an example of a basic batch script, which shows key features including naming the job/output file, selecting the SLURM queue partition, defining the number of nodes and ocres, and the length of time that the job will need:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[mthomas@comet-ln3 IBRUN]$ cat hellompi-slurm.sb
#!/bin/bash
#SBATCH --job-name="hellompi"
#SBATCH --output="hellompi.%j.%N.out"
#SBATCH --partition=compute
#SBATCH --nodes=2
#SBATCH --ntasks-per-node=24
#SBATCH --export=ALL
#SBATCH -t 00:30:00

#Define user environment
source /etc/profile.d/modules.sh
module purge
module load intel
module load mvapich2_ib

#This job runs with 2 nodes, 24 cores per node for a total of 48 cores.
#ibrun in verbose mode will give binding detail

ibrun -v ../hello_mpi
</code></pre></div></div><p>Note that we have included configuring the user environment by purging and then loading the necessary modules. While not required, it is a good habit to develop when building batch scripts.</p><p><a href="#top">Back to Top</a></p><hr /><h3 id="slurm-partitions-"> <a href="#slurm-partitions-" class="anchor-heading" aria-labelledby="slurm-partitions-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Slurm Partitions <a name="slurm-partitions"></a></h3><p>Comet places limits on the number of jobs queued and running on a per group (allocation) and partition basis. Please note that submitting a large number of jobs (especially very short ones) can impact the overall scheduler response for all users.</p><p><img src="images/comet-queue-names.png" alt="Comet Queue Names" width="500px" /></p><p>Specified using -p option in batch script. For example:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#SBATCH -p gpu
</code></pre></div></div><p><a href="#top">Back to Top</a></p><hr /><h3 id="slurm-commands-"> <a href="#slurm-commands-" class="anchor-heading" aria-labelledby="slurm-commands-"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Slurm Commands: <a name="slurm-commands"></a></h3><p>Here are a few key Slurm commands. For more information, run the <code class="language-plaintext highlighter-rouge">man slurm</code> or see this page:</p><ul><li>To Submit jobs using the <code class="language-plaintext highlighter-rouge">sbatch</code> command:</ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sbatch Localscratch-slurm.sb 
Submitted batch job 8718049
</code></pre></div></div><ul><li>To check job status using the squeue command: <code class="language-plaintext highlighter-rouge"> $ squeue -u $USER              JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)                         8718049   compute localscr mahidhar PD       0:00      1 (Priority)                        </code>                         * Once the job is running, you will see the job status change:                         <code class="language-plaintext highlighter-rouge">                         $ squeue -u $USER                                      JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)                                                 8718064     debug localscr mahidhar  R       0:02      1 comet-14-01                                                </code>                                                 * To cancel a job, use the <code class="language-plaintext highlighter-rouge">scancel</code> along with the <code class="language-plaintext highlighter-rouge">JOBID</code>:                                                 * $scancel <jobid>                                                                                                 ### Command Line Jobs <a name="running-jobs-cmdline"></a>                                                 The login nodes are meant for compilation, file editing, simple data analysis, and other tasks that use minimal compute resources. <em>Do not run parallel or large jobs on the login nodes - even for simple tests</em>. Even if you could run a simple test on the command line on the login node, full tests should not be run on the login node because the performance will be adversely impacted by all the other tasks and login activities of the other users who are logged onto the same node. For example, at the moment that this note was written, a `gzip` process was consuming 98% of the CPU time:                                                 ```                                                 [mthomas@comet-ln3 OPENMP]$ top                                                 ...                                                 PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND                                                 19937 XXXXX 20 0 4304 680 300 R 98.2 0.0 0:19.45 gzip                                                 ```                                                                                                 Commands that you type into the terminal and run on the sytem are considered *jobs* and they consume resources. <em>Computationally intensive jobs should be run only on the compute nodes and not the login nodes</em>.                                                                                                 [Back to Top](#top)                                                 &lt;hr&gt;</jobid></ul><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-000 mb-0">Copyright &copy; Cyber Infrastructure Machine Learning MIT license.</a></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/Lzy17/expanse101-Jekyll/tree/main/docs/comet-101/Running Jobs.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
