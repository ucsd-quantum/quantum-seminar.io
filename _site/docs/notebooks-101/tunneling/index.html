<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../icon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../icon/favicon-16x16.png"><link rel="manifest" href="../icon/site.webmanifest"><link rel="mask-icon" href="../icon/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/dev.io/assets/css/just-the-docs-default.css"><link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-blue.min.css" /> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2709176-10"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2709176-10', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="/dev.io/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/dev.io/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Security with SSH Tunneling | SDSC-101-Dev</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Security with SSH Tunneling" /><meta property="og:locale" content="en_US" /><meta name="description" content="SDSC-101 Dev branch" /><meta property="og:description" content="SDSC-101 Dev branch" /><link rel="canonical" href="http://localhost:4000/dev.io/docs/notebooks-101/tunneling/" /><meta property="og:url" content="http://localhost:4000/dev.io/docs/notebooks-101/tunneling/" /><meta property="og:site_name" content="SDSC-101-Dev" /> <script type="application/ld+json"> {"description":"SDSC-101 Dev branch","url":"http://localhost:4000/dev.io/docs/notebooks-101/tunneling/","@type":"WebPage","headline":"Security with SSH Tunneling","@context":"https://schema.org"}</script> <button class="btn js-toggle-dark-mode">dark scheme</button> <script> const toggleDarkMode = document.querySelector('.js-toggle-dark-mode'); jtd.addEvent(toggleDarkMode, 'click', function(){ if (jtd.getTheme() === 'dark') { jtd.setTheme('light'); toggleDarkMode.textContent = 'dark scheme'; } else { jtd.setTheme('dark'); toggleDarkMode.textContent = 'light scheme'; } }); </script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000/dev.io/" class="site-title lh-tight"> SDSC-101-Dev </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/comet" class="nav-list-link">Comet 101</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Comet%20Overview/" class="nav-list-link">Comet Overview</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Getting%20Started%20on%20Comet/" class="nav-list-link">Getting Started on Comet</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Customizing/" class="nav-list-link">Customizing Your User Environment</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Compiling/" class="nav-list-link">Compiling & Linking</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/comet-101/Running%20Jobs/" class="nav-list-link">Running Jobs on Comet</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/comet/examples" class="nav-list-link">Hands-on Examples</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/comet-101/gpu/" class="nav-list-link">comp-and-run-cuda-jobs</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/comet-101/cpu/" class="nav-list-link">Compiling and Running CPU Jobss</a></ul></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/expanse" class="nav-list-link">Expanse 101</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/Expanse%20Overview/" class="nav-list-link">Expanse Overview</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/start/" class="nav-list-link">Getting Started on Expanse</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/Customizing/" class="nav-list-link">Customizing Your User Environment</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/Compiling/" class="nav-list-link">Compiling & Linking</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/expanse-101/slurm/" class="nav-list-link">Using Slurm on Comet</a><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/expanse/examples" class="nav-list-link">Hands-on Examples</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/expanse-101/gpu/" class="nav-list-link">comp-and-run-cuda-jobs</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/expanse-101/cpu/" class="nav-list-link">Compiling and Running CPU Jobs</a></ul></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/notebooks" class="nav-list-link">notebooks-101</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/contactus/" class="nav-list-link">Contact Us</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/overview/" class="nav-list-link">Jupyter Notebook Overview</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/prerequisites/" class="nav-list-link">Software Prerequisites</a><li class="nav-list-item "><a href="http://localhost:4000/dev.io/docs/notebooks-101/aboutus/" class="nav-list-link">About the Team</a><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/dev.io/docs/notebooks/examples" class="nav-list-link">Example Notebooks</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/notebooks-101/httpConnect/" class="nav-list-link">Insecurity with direct node access</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/notebooks-101/reverseProxy/" class="nav-list-link">Security with Reverse Proxy Service</a><li class="nav-list-item "> <a href="http://localhost:4000/dev.io/docs/notebooks-101/runJupyterMethods/" class="nav-list-link">Jupyter Services on Comet</a><li class="nav-list-item active"> <a href="http://localhost:4000/dev.io/docs/notebooks-101/tunneling/" class="nav-list-link active">Security with SSH Tunneling</a></ul></ul></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search SDSC-101-Dev" aria-label="Search SDSC-101-Dev" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="" class="site-button" > SDSC 101 on GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/dev.io/docs/notebooks">notebooks-101</a><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/dev.io/docs/notebooks/examples">Example Notebooks</a><li class="breadcrumb-nav-list-item"><span>Security with SSH Tunneling</span></ol></nav><div id="main-content" class="main-content" role="main"><h2 id="security-with-ssh-tunneling"> <a href="#security-with-ssh-tunneling" class="anchor-heading" aria-labelledby="security-with-ssh-tunneling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Security with SSH Tunneling</h2><p>Connection to Notebook over SSH tunneling (secure)</p><p><img src="https://github.com/sdsc-hpc-training-org/notebooks-101/blob/master/Docs/images/jupyter-notebook-http-ssh-tunnel.png?raw=true" alt="connection over HTTP" /></p><p>This section shows you how to launch a Jupyter Notebook using an interactive node or on a compute node, and to use ssh tunneling to securely connect to the notebook server.</p><h3 id="interactive-node-method"> <a href="#interactive-node-method" class="anchor-heading" aria-labelledby="interactive-node-method"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interactive Node Method</h3><h4 id="open-two-terminals-on-your-computer"> <a href="#open-two-terminals-on-your-computer" class="anchor-heading" aria-labelledby="open-two-terminals-on-your-computer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Open two terminals on your computer</h4><p>We will use one terminal to start the notebook, and the other to establish the tunnel. Pick the first terminal, call it T1.</p><h4 id="ssh-into-comet-from-your-local-computer"> <a href="#ssh-into-comet-from-your-local-computer" class="anchor-heading" aria-labelledby="ssh-into-comet-from-your-local-computer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SSH into comet from your local computer:</h4><p>In T1, <code class="language-plaintext highlighter-rouge">ssh user@comet.sdsc.edu</code>. This is just a regular SSH login.</p><h4 id="claim-an-interactive-node"> <a href="#claim-an-interactive-node" class="anchor-heading" aria-labelledby="claim-an-interactive-node"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Claim an interactive node</h4><p>In T1, <code class="language-plaintext highlighter-rouge">srun --partition=debug --pty --nodes=1 --ntasks-per-node=24 -t 00:30:00 --wait=0 --export=ALL /bin/bash</code></p><p><a href="https://www.sdsc.edu/support/user_guides/comet.html">Source: Comet User Guide</a></p><p>Feel free to adjust the parameters, but remember that in the debug partition you can only claim a node for up to 30 minutes. You can use other queues, but you may have to wait longer. Take note of the <code class="language-plaintext highlighter-rouge">&lt;node name&gt;</code> of the interactive node.</p><h4 id="start-a-jupyter-notebook-server-on-the-interactive-node"> <a href="#start-a-jupyter-notebook-server-on-the-interactive-node" class="anchor-heading" aria-labelledby="start-a-jupyter-notebook-server-on-the-interactive-node"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Start a jupyter notebook server on the interactive node.</h4><p>In T1, run the command <code class="language-plaintext highlighter-rouge">jupyter notebook --no-browser</code></p><p>The <code class="language-plaintext highlighter-rouge">no browser</code> option is required, otherwise the program may think you want a text representation of your outputs in the terminal, which trust me - you don’t want. You can also specify a port number if you wish using the <code class="language-plaintext highlighter-rouge">--port 1234</code> option. Note the value of the <code class="language-plaintext highlighter-rouge">&lt;jupyter port&gt;</code> number returned by the command.</p><h4 id="create-ssh-tunnel-connection"> <a href="#create-ssh-tunnel-connection" class="anchor-heading" aria-labelledby="create-ssh-tunnel-connection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create SSH Tunnel Connection</h4><p>In the next command, you will create an ssh connection between your local host and the notebook port on the remote, interactive node. When you connect your browser to the notebook service, this will channel all communications via the SSH connection, which is secure and encrypted. In the second terminal, call it T2, run the command</p><p><code class="language-plaintext highlighter-rouge">ssh -L 8888:127.0.0.1:&lt;jupyter port&gt; user@comet-14-01.sdsc.edu</code> Replace <code class="language-plaintext highlighter-rouge">comet-14-01</code> with the name of the compute node. You can view the compute node in T1 prompt. Replace the <code class="language-plaintext highlighter-rouge">&lt;jupyter port&gt;</code> with the port the jupyter notebook started on after running the <code class="language-plaintext highlighter-rouge">jupyter notebook --no-browser</code> command in window T1. The default jupyter port number is 8888, but don’t worry if its different. This establishes a tunnel between port 8888 on your computer and the jupyter port on the compute node</p><h4 id="visit-the-port-in-your-local-browser"> <a href="#visit-the-port-in-your-local-browser" class="anchor-heading" aria-labelledby="visit-the-port-in-your-local-browser"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Visit the port in your local browser</h4><p>In any browser, type in 127.0.0.1:8888 and you should get your notebook. You’ll have to input the jupyter token available in your terminal.</p><p>If for some reason that address doesn’t work, check the output of the terminal. You could try using the address localhost:8888 or 0.0.0.0:8888. The reason tunneling is generally not the prefered method is because it is complicated and the port numbers sometimes are not available by the time you access the service. And, you can’t know the port the jupyter notebook is going end up open on until you start it on the node, and you need to tunnel through that port… which is why we need two terminals in this example.</p><h3 id="compute-node-method"> <a href="#compute-node-method" class="anchor-heading" aria-labelledby="compute-node-method"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Compute Node Method</h3><p>In this example, we use a batch script to obtain a compute node, and to launch a jupyter lab or notebook. You can access the jupyter service directly from your browser once it has started running on the comet node. This method uses the SSH Tunneling method described above to make a secure SSH connection between your laptop and the Jupyter services.</p><p>First, log onto comet using SSH.</p><h4 id="copy-the-batch-script-example"> <a href="#copy-the-batch-script-example" class="anchor-heading" aria-labelledby="copy-the-batch-script-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Copy the batch script example</h4><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/usr/bin/env bash
#SBATCH --job-name=tensorflow-compute
#SBATCH --partition=compute
#SBATCH --time=00:30:00
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=24
#SBATCH --output=tensorflow-compute.o%j.%N
module purge
module list
printenv
time -p singularity exec /share/apps/compute/singularity/images/tensorflow/tensorflow-cpu.simg jupyter lab --no-browser --ip="$(hostname)"
</code></pre></div></div><p>This example uses the tensorflow singularity container available on comet. You can use any container you want. If you check out <code class="language-plaintext highlighter-rouge">/share/apps/computer/singularity</code> you can find many useful containers. The key part of this example is how the jupyter lab is started at the end - <code class="language-plaintext highlighter-rouge">jupyter lab --no-browser --ip "${hostname}"</code>.</p><h4 id="submit-this-script-to-the-queue"> <a href="#submit-this-script-to-the-queue" class="anchor-heading" aria-labelledby="submit-this-script-to-the-queue"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Submit this script to the queue</h4><p>Simply run <code class="language-plaintext highlighter-rouge">sbatch run-jupyter-tensorflow-compute.sh</code> One thing you may want to do is change the script to be <code class="language-plaintext highlighter-rouge">--partition=debug</code> if you want a shorter wait time.</p><h4 id="access-the-node-in-your-browser"> <a href="#access-the-node-in-your-browser" class="anchor-heading" aria-labelledby="access-the-node-in-your-browser"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Access the node in your browser</h4><p>First, wait for the job to be submitted to the queue. Then, monitor the output file created by your batch job, which looks something like <code class="language-plaintext highlighter-rouge">tensorflow-compute.o%j.%N</code> if you used the example. Inside this file, you will see the output of the jupyterlab command. There, you should be able to see the port the jupyterlab server is running on, as well as the token you will need to login. My recommendation would be to just memorize the port number and copy the jupyter token. The port is almost always 8888 so it shouldn’t be that hard to remember. You will also need to know the comet node you are logged in on. You can view this by typing this command: <code class="language-plaintext highlighter-rouge">squeue -u $USER</code>. Under the NODELIST section you can see the comet node.</p><p>Open up a new tab in your browser, and type in the following: <code class="language-plaintext highlighter-rouge">http://comet-xx-xx.sdsc.edu:PPPP</code> where <code class="language-plaintext highlighter-rouge">comet-xx-xx</code> is the comet node, <code class="language-plaintext highlighter-rouge">PPPP</code> is the port number (usually 8888). The jupyter notebook page should show up, and you can now paste in the token from the output file.</p><h4 id="use-your-jupyterlabjupyter-notebook-server"> <a href="#use-your-jupyterlabjupyter-notebook-server" class="anchor-heading" aria-labelledby="use-your-jupyterlabjupyter-notebook-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use your jupyterlab/jupyter notebook server!</h4><p>Enjoy. Note that your notebook connection is <em>secured and encrypted</em>.</p><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-000 mb-0">Copyright &copy; Cyber Infrastructure Machine Learning MIT license.</a></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/Lzy17/expanse101-Jekyll/tree/main/docs/notebooks-101/tunneling.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
